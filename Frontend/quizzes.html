<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>BrillX - AI Quiz Generator</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    
    <!-- Google Web Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600&family=Nunito:wght@600;700;800&display=swap" rel="stylesheet">
    
    <!-- Icon Font Stylesheet -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.4.1/font/bootstrap-icons.css" rel="stylesheet">
    
    <!-- Marked.js for Markdown Parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js"></script>
    
    <style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
  background-color: #f5f7fa;
  color: #333;
  min-height: 100vh;
}

/* --- NAVIGATION BAR --- */
.navbar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background-color: #fffcfc;
  padding: 0 25px;
  height: 70px;
  border-bottom: 1px solid #e0e0e0;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  z-index: 1000;
}

/* --- LEFT SECTION: MENU + LOGO --- */
.navbar-left {
  display: flex;
  align-items: center;
  gap: 5px;
}

/* --- MENU BUTTON --- */
.menu-btn {
  background: none;
  border: none;
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  transition: background-color 0.3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.menu-btn:hover {
  background-color: #f0f0f0;
  transform: scale(1.1);
}

.menu-image img {
  width: 26px;
  height: 26px;
  object-fit: contain;
}

/* --- LOGO --- */
.logo {
  display: flex;
  align-items: center;
  height: 51px;
}

.logo-img {
  height: 45px;
  width: auto;
  object-fit: contain;
}

/* --- RIGHT SECTION: SEARCH + ICONS + PROFILE --- */
.navbar-right {
  display: flex;
  align-items: center;
  gap: 20px;
  margin-left: auto;
}

/* Compact Dark Mode Toggle */
.toggle-checkbox {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.toggle-slot {
  font-size: 8px;
  position: relative;
  height: 2.5em;
  width: 5em;
  border: 0px solid transparent;
  border-radius: 10em;
  background-color: white;
  transition: background-color 250ms;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.toggle-checkbox:checked ~ .toggle-slot {
  background-color: #374151;
}

.toggle-button {
  transform: translate(0.2em, 0.2em);
  position: absolute;
  height: 2.1em;
  width: 2.1em;
  border-radius: 50%;
  background-color: #ffeccf;
  box-shadow: inset 0px 0px 0px 0.5em #ffbb52;
  transition: background-color 250ms, transform 500ms cubic-bezier(.26,2,.46,.71);
}

.toggle-checkbox:checked ~ .toggle-slot .toggle-button {
  background-color: #485367;
  box-shadow: inset 0px 0px 0px 0.5em white;
  transform: translate(2.7em, 0.2em);
}

.sun-icon,
.moon-icon {
  position: absolute;
  height: 4em;
  width: 4em;
}

.sun-icon {
  color: #ffbb52;
}

.moon-icon {
  color: white;
}

.sun-icon-wrapper {
  position: absolute;
  height: 4em;
  width: 4em;
  opacity: 1;
  transform: translate(1.5em, 1.5em);
  transition: opacity 150ms, transform 500ms cubic-bezier(.26,2,.46,.71);
}

.toggle-checkbox:checked ~ .toggle-slot .sun-icon-wrapper {
  opacity: 0;
  transform: translate(2em, 1.5em);
}

.moon-icon-wrapper {
  position: absolute;
  height: 4em;
  width: 4em;
  opacity: 0;
  transform: translate(2em, 1.5em);
  transition: opacity 150ms, transform 500ms cubic-bezier(.26,2.5,.46,.71);
}

.toggle-checkbox:checked ~ .toggle-slot .moon-icon-wrapper {
  opacity: 1;
  transform: translate(1.5em, 1.5em);
}

/* --- SEARCH CONTAINER --- */
.search-container {
  position: relative;
  display: flex;
  align-items: center;
}

.search-box {
  width: 300px;
  height: 40px;
  padding: 10px 40px 10px 15px;
  border: 1px solid #ddd;
  border-radius: 6px;
  font-size: 14px;
  background-color: #f8f9fa;
  color: #333;
  transition: all 0.3s ease;
}

.search-box::placeholder {
  color: #888;
  font-weight: 500;
}

.search-box:focus {
  outline: none;
  border-color: #3a86ff;
  background-color: #fff;
  box-shadow: 0 0 0 2px rgba(58, 134, 255, 0.15);
}

.search-icon {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  color: #555;
  font-size: 15px;
  cursor: pointer;
  transition: color 0.2s;
}

.search-icon:hover {
  color: #3a86ff;
}

/* --- ICON CONTAINER --- */
.icon-container {
  display: flex;
  align-items: center;
  gap: 20px;
}

.icon-img {
  width: 30px;
  height: 30px;
  cursor: pointer;
  transition: transform 0.2s ease;
  object-fit: contain;
}

.icon-img:hover {
  transform: scale(1.1);
}

/* --- NOTIFICATION ICON --- */
.notification-icon {
  position: relative;
}

/* --- PROFILE IMAGE --- */


.profile-icon {
  border-radius: 50%;
  width: 35px;
  height: 35px;
  overflow: hidden;
  border: 2px solid #eff1f5;
  cursor: pointer;
  transition: transform 0.2s ease;
}
    .profile-img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      overflow: hidden;
    border: 2px solid #eff1f5;
    cursor: pointer;
    transition: transform 0.2s ease;
    }

    .dropdown-menu {
      position: absolute;
      top: 100%;
      right: 0;
      width: 200px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      padding: 8px 0;
      opacity: 0;
      visibility: hidden;
      transform: translateY(-10px);
      transition: all 0.3s ease;
      z-index: 1001;
    }

    .dropdown-menu.active {
      opacity: 1;
      visibility: visible;
      transform: translateY(0);
    }

    .dropdown-item {
      display: flex;
      align-items: center;
      width: 100%;
      padding: 10px 16px;
      background: none;
      border: none;
      text-align: left;
      cursor: pointer;
      font-size: 14px;
      color: #333;
      transition: background-color 0.2s;
    }

    .dropdown-item:hover {
      background-color: #f5f5f5;
    }

    .dropdown-item i {
      margin-right: 10px;
      font-style: normal;
    }

    .dropdown-divider {
      height: 1px;
      background-color: #eee;
      margin: 8px 0;
    }

    .signout {
      color: #ff4757;
    }

/* --- SIDE MENU STYLES --- */
.side-menu {
  position: fixed;
  top: 70px;
  left: -250px;
  width: 230px;
  height: calc(100vh - 70px);
  background-color: #fff;
  border-right: 1px solid #e0e0e0;
  z-index: 999;
  padding: 0;
  transition: left 0.3s ease;
}

.side-menu.active {
  left: 0;
}

/* Menu Items Container */
.menu-items {
  padding: 15px 0;
}

/* Menu Section Headers */
.menu-section {
  font-size: 11px;
  color: #666;
  font-weight: 600;
  text-transform: none !important;
  letter-spacing: 0.5px;
  padding: 15px 20px 8px 20px;
  margin-top: 5px;
  text-decoration: none !important;
}

.menu-section:first-child {
  margin-top: 0;
}

/* Menu Items */
.menu-item {
  padding: 10px 20px;
  display: flex;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  margin: 2px 0;
  text-transform: none !important;
  text-decoration: none !important;
}

/* Simple Hover Effect */
.menu-item:hover {
  background-color: #f5f7fa;
  margin-left: 5px;
  text-decoration: none !important;
}

/* Active State */
.menu-item.active {
  background-color: #e8f2ff;
  border-left: 3px solid #3a86ff;
  text-decoration: none !important;
}

.menu-item.active .menu-icon {
  color: #3a86ff;
}

.menu-item.active .menu-text {
  color: #3a86ff;
  font-weight: 500;
  text-decoration: none !important;
}

/* Menu Icons */
.menu-icon {
  width: 16px;
  height: 16px;
  color: #666;
  font-size: 14px;
  text-align: center;
  text-decoration: none !important;
}

/* Menu Text */
.menu-text {
  font-size: 14px;
  color: #333;
  font-weight: 400;
  text-transform: none !important;
  text-decoration: none !important;
}

/* Hover effect on text and icon */
.menu-item:hover .menu-text {
  color: #3a86ff;
  text-transform: none !important;
  text-decoration: none !important;
}

.menu-item:hover .menu-icon {
  color: #3a86ff;
  text-transform: none !important;
}

/* Menu Animation */
@keyframes fadeSlideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.side-menu.active .menu-item {
  animation: fadeSlideUp 0.4s ease forwards;
  opacity: 0;
}

.side-menu.active .menu-item:nth-child(2) { animation-delay: 0.1s; }
.side-menu.active .menu-item:nth-child(3) { animation-delay: 0.15s; }
.side-menu.active .menu-item:nth-child(5) { animation-delay: 0.2s; }
.side-menu.active .menu-item:nth-child(6) { animation-delay: 0.25s; }
.side-menu.active .menu-item:nth-child(7) { animation-delay: 0.3s; }
.side-menu.active .menu-item:nth-child(8) { animation-delay: 0.35s; }
.side-menu.active .menu-item:nth-child(9) { animation-delay: 0.4s; }
.side-menu.active .menu-item:nth-child(11) { animation-delay: 0.45s; }
.side-menu.active .menu-item:nth-child(12) { animation-delay: 0.5s; }
.side-menu.active .menu-item:nth-child(14) { animation-delay: 0.55s; }
.side-menu.active .menu-item:nth-child(15) { animation-delay: 0.6s; }

        /* Main Content */
        .main-content {
            margin-top: 70px;
            min-height: calc(100vh - 70px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
        }

        /* Container */
        .container {
            max-width: 1000px;
            width: 100%;
            background: white;
            border-radius: 12px;
            padding: 50px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.08);
        }

        /* Start Page */
        .start-page {
            text-align: center;
        }

        .start-page h1 {
            font-size: 42px;
            color: #3f61fb;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .start-page p {
            font-size: 18px;
            color: #666;
            margin-bottom: 50px;
        }

        .form-group {
            margin-bottom: 30px;
            text-align: left;
        }

        .form-group label {
            display: block;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            background: #f8f9fa;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            color: #333;
            font-size: 15px;
            outline: none;
            transition: all 0.3s;
            font-family: 'Heebo', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus {
            border-color: #3f61fb;
            background: white;
            box-shadow: 0 0 0 3px rgba(63,97,251,0.1);
        }

        .btn {
            width: 100%;
            padding: 16px 24px;
            background: #3f61fb;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            background: #2d4dd4;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(63,97,251,0.25);
        }

        .btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
            transform: none;
        }

        /* Quiz Page */
        .quiz-page {
            display: none;
        }

        .quiz-page.active {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e8efff;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3f61fb, #fb873f);
            transition: width 0.3s ease;
            border-radius: 5px;
        }

        .progress-text {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 15px;
            font-weight: 500;
        }

        .question-container {
            background: #f8f9fa;
            padding: 35px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e5e7eb;
        }

        .question-text {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #1e293b;
        }

        .option {
            background: white;
            padding: 18px 22px;
            border-radius: 10px;
            margin-bottom: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .option:hover {
            background: #f0f4ff;
            border-color: #3f61fb;
            transform: translateX(4px);
        }

        .option.selected {
            background: #e8efff;
            border-color: #3f61fb;
        }

        .option-label {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #3f61fb;
            flex-shrink: 0;
        }

        .option.selected .option-label {
            background: #3f61fb;
            color: white;
        }

        .option-text {
            flex: 1;
            font-size: 15px;
            color: #334155;
        }

        .btn-group {
            display: flex;
            gap: 15px;
        }

        .btn-secondary {
            background: #e5e7eb;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #cbd5e1;
        }

        /* Results Page */
        .results-page {
            display: none;
        }

        .results-page.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            text-align: center;
            margin-bottom: 50px;
            padding: 30px;
            background: linear-gradient(135deg, #e8efff 0%, #f0f4ff 100%);
            border-radius: 12px;
        }

        .results-header h1 {
            font-size: 38px;
            color: #3f61fb;
            margin-bottom: 15px;
        }

        .score-display {
            font-size: 56px;
            font-weight: 700;
            background: linear-gradient(135deg, #3f61fb 0%, #fb873f 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin: 20px 0;
        }

        .score-details {
            font-size: 18px;
            color: #64748b;
            font-weight: 500;
        }

        .analysis-section {
            background: white;
            padding: 40px;
            border-radius: 12px;
            margin-bottom: 3px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .analysis-section h2 {
            font-size: 24px;
            margin-bottom: 2.5px;
            color: #3f61fb;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Markdown Content Styling */
        .analysis-content {
            line-height: 1.8;
            color: #334155;
            font-size: 15px;
            white-space: normal;
        }

        .analysis-content h1 {
            font-size: 28px;
            color: #1e293b;
            margin: 25px 0 1px 0;
            font-weight: 700;
        }

        .analysis-content h2 {
            font-size: 24px;
            color: #334155;
            margin: 25px 0 1px 0;
            font-weight: 600;
            border-bottom: 2px solid #e8efff;
            padding-bottom: 8px;
        }

        .analysis-content h3 {
            font-size: 20px;
            color: #475569;
            margin: 20px 0 1px 0;
            font-weight: 600;
        }

        .analysis-content p {
            margin-bottom: 1px;
            color: #475569;
        }

        .analysis-content ul, .analysis-content ol {
            margin: 15px 0 15px 25px;
            padding-left: 2px;
        }

        .analysis-content li {
            margin-bottom: 1px;
            color: #475569;
            line-height: 1.7;
        }

        .analysis-content strong, .analysis-content b {
            color: #1e293b;
            font-weight: 700;
        }

        .analysis-content em, .analysis-content i {
            color: #64748b;
        }

        .analysis-content code {
            background: #f1f5f9;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #e11d48;
        }

        .analysis-content pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 20px 0;
        }

        .analysis-content pre code {
            background: none;
            color: #e2e8f0;
            padding: 0;
        }

        .analysis-content blockquote {
            border-left: 4px solid #3f61fb;
            padding-left: 20px;
            margin: 20px 0;
            color: #64748b;
            font-style: italic;
        }

        .analysis-content hr {
            border: none;
            border-top: 2px solid #e5e7eb;
            margin: 30px 0;
        }

        .analysis-content table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .analysis-content table th,
        .analysis-content table td {
            border: 1px solid #e5e7eb;
            padding: 12px;
            text-align: left;
        }

        .analysis-content table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #1e293b;
        }

        /* Custom highlight classes for incorrect/correct */
        .analysis-content .highlight-incorrect,
        .analysis-content [class*="incorrect" i] {
            color: #dc2626 !important;
            font-weight: 600;
        }

        .analysis-content .highlight-correct,
        .analysis-content [class*="correct" i] {
            color: #16a34a !important;
            font-weight: 600;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #e5e7eb;
            border-top-color: #3f61fb;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 30px 20px;
            }

            .start-page h1 {
                font-size: 32px;
            }

            .question-text {
                font-size: 19px;
            }

            .navbar {
                padding: 0 15px;
            }

            .btn-group {
                flex-direction: column;
            }

            .analysis-section {
                padding: 25px 20px;
            }
        }
    </style>
</head>

<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="navbar-left">
      <!-- Menu Button with Image -->
      <button class="menu-btn" id="menuBtn">
        <div class="menu-image">
          <img src="images/menus.png" alt="Menu Icon" />
        </div>
      </button>

      <!-- Logo -->
      <div class="logo">
        <img src="images/brillx-logo.png" alt="BrillX Logo" class="logo-img" />
      </div>
    </div>

    <div class="navbar-right">
      <!-- Search Box -->
      <div class="search-container">
        <input type="text" class="search-box" placeholder="Search">
        <i class="fas fa-search search-icon"></i>
      </div>

      <label>
        <input class="toggle-checkbox" type="checkbox" id="themeToggle">
        <div class="toggle-slot">
          <div class="sun-icon-wrapper">
            <div class="iconify sun-icon" data-icon="feather-sun" data-inline="false"></div>
          </div>
          <div class="toggle-button"></div>
          <div class="moon-icon-wrapper">
            <div class="iconify moon-icon" data-icon="feather-moon" data-inline="false"></div>
          </div>
        </div>
      </label>

      <!-- Icons Container -->
      <div class="icon-container">
        <!-- Notification Image -->
        <div class="notification-icon">
          <img src="images/bell.png" alt="Notification Icon" class="icon-img" />
          <div class="notification-badge"></div>
        </div>

        <!-- Profile Image with Clerk Integration -->
        <div class="user-menu">
          <button class="user-button" id="user-button">
            <img src="images/user.png" alt="User Profile" class="profile-img user-avatar" id="user-avatar" onerror="this.style.display='none'" />
          </button>
          
          <div class="dropdown-menu" id="dropdown-menu">
            <button class="dropdown-item" id="profile-btn">
              <i>üë§</i>
              <span>Profile</span>
            </button>
            <button class="dropdown-item" id="settings-btn">
              <i>‚öôÔ∏è</i>
              <span>Settings</span>
            </button>
            <div class="dropdown-divider"></div>
            <button class="dropdown-item signout" id="signout-btn">
              <i>üö™</i>
              <span>Sign Out</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Side Menu -->
  <div class="side-menu" id="sideMenu">
    <div class="menu-items">
      <!-- Home Section -->
      <div class="menu-section">Home</div>
      
      <a href="dashboard.html" class="menu-item">
        <i class="fas fa-tachometer-alt menu-icon"></i>
        <span class="menu-text">Dashboard</span>
      </a>
      
      <a href="student_report.html" class="menu-item ">
        <i class="fas fa-chart-bar menu-icon"></i>
        <span class="menu-text">Student Report</span>
      </a>

      <!-- Learning Section -->
      <div class="menu-section">Learning</div>

      <a href="courses.html" class="menu-item">
        <i class="fas fa-book menu-icon"></i>
        <span class="menu-text">Courses</span>
      </a>

      <a href="batches.html" class="menu-item">
        <i class="fas fa-users menu-icon"></i>
        <span class="menu-text">Batches</span>
      </a>

      <a href="assignments.html" class="menu-item">
        <i class="fas fa-tasks menu-icon"></i>
        <span class="menu-text">Assignments</span>
      </a>

      <a href="quizzes.html" class="menu-item active">
        <i class="fas fa-question-circle menu-icon"></i>
        <span class="menu-text">Quizzes</span>
      </a>

      <a href="test.html" class="menu-item">
        <i class="fas fa-file-alt menu-icon"></i>
        <span class="menu-text">Test</span>
      </a>

      <!-- Mentor Section -->
      <div class="menu-section">Mentor</div>
      
      <a href="ai-mentor.html" class="menu-item">
        <i class="fas fa-robot menu-icon"></i>
        <span class="menu-text">AI Mentor</span>
      </a>
      
      <a href="pdf-chatbot.html" class="menu-item">
        <i class="fas fa-file-pdf menu-icon"></i>
        <span class="menu-text">PDF Chatbot</span>
      </a>

      <!-- Social Section -->
      <div class="menu-section">Social</div>
      
      <a href="community.html" class="menu-item">
        <i class="fas fa-users menu-icon"></i>
        <span class="menu-text">Community</span>
      </a>
      
      <a href="help-support.html" class="menu-item">
        <i class="fas fa-life-ring menu-icon"></i>
        <span class="menu-text">Help & Support</span>
      </a>
    </div>
  </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <!-- Start Page -->
            <div class="start-page" id="startPage">
                <h1>üéØ AI Quiz Generator</h1>
                <p>Generate custom quizzes on any topic with AI-powered questions</p>

                <div class="form-group">
                    <label for="topicInput">Enter Quiz Topic:</label>
                    <input type="text" id="topicInput" placeholder="e.g., JavaScript, World History, Biology...">
                </div>

                <div class="form-group">
                    <label for="numQuestions">Number of Questions:</label>
                    <select id="numQuestions">
                        <option value="5">5 Questions</option>
                        <option value="10" selected>10 Questions</option>
                        <option value="15">15 Questions</option>
                        <option value="20">20 Questions</option>
                        <option value="25">25 Questions</option>
                        <option value="30">30 Questions</option>
                    </select>
                </div>

                <button class="btn" id="generateBtn" onclick="generateQuiz()">
                    <i class="fas fa-magic"></i> Generate Quiz
                </button>
            </div>

            <!-- Quiz Page -->
            <div class="quiz-page" id="quizPage">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText"></div>

                <div class="question-container">
                    <div class="question-text" id="questionText"></div>
                    <div id="optionsContainer"></div>
                </div>

                <div class="btn-group">
                    <button class="btn" id="nextBtn" onclick="nextQuestion()">
                        Next Question <i class="fas fa-arrow-right"></i>
                    </button>
                    <button class="btn btn-secondary" onclick="previousQuestion()">
                        <i class="fas fa-arrow-left"></i> Previous Question
                    </button>
                </div>
            </div>

            <!-- Results Page -->
            <div class="results-page" id="resultsPage">
                <div class="results-header">
                    <h1>üéâ Quiz Complete!</h1>
                    <div class="score-display" id="scoreDisplay">0%</div>
                    <div class="score-details" id="scoreDetails"></div>
                </div>

                <div class="analysis-section">
                    <h2><i class="fas fa-chart-line"></i> Performance Analysis</h2>
                    <div class="analysis-content" id="analysisContent">
                        <p style="text-align: center; color: #94a3b8;">
                            <i class="fas fa-spinner fa-spin"></i> Generating detailed analysis...
                        </p>
                    </div>
                </div>

                <button class="btn" onclick="restartQuiz()">
                    <i class="fas fa-redo"></i> Start New Quiz
                </button>
            </div>
        </div>
    </div>

<script>
    // Toggle side menu
    const menuBtn = document.getElementById('menuBtn');
    const sideMenu = document.getElementById('sideMenu');

    if (menuBtn && sideMenu) {
        menuBtn.addEventListener('click', () => {
            sideMenu.classList.toggle('active');
        });
    }
</script>

    <script>
        const API_BASE_URL = 'https://40ebaccdab30.ngrok-free.app';
        
        let questions = [];
        let currentQuestionIndex = 0;
        let userAnswers = [];
        let quizTopic = '';

        // Configure marked.js options
        marked.setOptions({
            breaks: true,
            gfm: true,
            headerIds: true,
            mangle: false
        });

        async function generateQuiz() {
            const topic = document.getElementById('topicInput').value.trim();
            const numQuestions = parseInt(document.getElementById('numQuestions').value);
            
            if (!topic) {
                alert('Please enter a quiz topic!');
                return;
            }

            const generateBtn = document.getElementById('generateBtn');
            generateBtn.disabled = true;
            generateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating Quiz...';

            try {
                const response = await fetch(`${API_BASE_URL}/api/quiz/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        topic: topic,
                        num_questions: numQuestions
                    })
                });

                if (!response.ok) {
                    throw new Error('Failed to generate quiz');
                }

                const data = await response.json();
                questions = data.questions;
                quizTopic = topic;
                userAnswers = new Array(questions.length).fill(null);
                currentQuestionIndex = 0;

                // Switch to quiz page
                document.getElementById('startPage').classList.add('hidden');
                document.getElementById('quizPage').classList.add('active');
                
                loadQuestion();

            } catch (error) {
                console.error('Error:', error);
                alert('Failed to generate quiz. Please try again.');
                generateBtn.disabled = false;
                generateBtn.innerHTML = '<i class="fas fa-magic"></i> Generate Quiz';
            }
        }

        function loadQuestion() {
            if (currentQuestionIndex >= questions.length) {
                showResults();
                return;
            }

            const question = questions[currentQuestionIndex];
            
            // Update progress
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('progressText').textContent = 
                `Question ${currentQuestionIndex + 1} of ${questions.length}`;

            // Display question
            document.getElementById('questionText').textContent = question.question;

            // Display options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            const options = ['A', 'B', 'C', 'D'];
            options.forEach(letter => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                if (userAnswers[currentQuestionIndex] === letter) {
                    optionDiv.classList.add('selected');
                }
                
                optionDiv.innerHTML = `
                    <div class="option-label">${letter}</div>
                    <div class="option-text">${question.options[letter]}</div>
                `;
                
                optionDiv.onclick = () => selectOption(letter, optionDiv);
                optionsContainer.appendChild(optionDiv);
            });
        }

        function selectOption(letter, element) {
            userAnswers[currentQuestionIndex] = letter;
            
            // Update UI
            const options = document.querySelectorAll('.option');
            options.forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
        }

        function nextQuestion() {
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                showResults();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }
        // ‚úÖ Make raw analysis text readable before marked.parse()
        function beautifyAnalysis(text) {
            let s = text;

            // 1) Put real breaks around horizontal rules and headings
            s = s.replace(/\s*---+\s*/g, '\n\n---\n\n');        // HRs
            s = s.replace(/(\n{0,2})###\s/g, '\n\n### ');       // H3
            s = s.replace(/(\n{0,2})##\s/g, '\n\n## ');         // H2
            s = s.replace(/(\n{0,2})#\s/g, '\n\n# ');           // H1

            // 2) Ensure lists start on their own lines
            s = s.replace(/([^\n])\s+-\s/g, '$1\n- ');          // bullets
            s = s.replace(/([^\n])\s+(\d+)\.\s/g, '$1\n$2. ');  // numbered

            // 3) Add a blank line between paragraphs when missing
            s = s.replace(/([^\n])\n(?!\n)(?=[A-Z0-9>"`*_#-])/g, '$1\n\n');

            // 4) Emphasize common labels
            s = s.replace(
                /(^|\n)\s*(Correct answer:|Why it‚Äôs right:|Common misconception:|What to study:|Correction:)/gi,
                '$1**$2**'
            );

            // 5) Make sure tables don‚Äôt stick to surrounding text
            s = s.replace(/([^\n])\n(\|.+\|)/g, '$1\n\n$2');     // blank line before table row
            s = s.replace(/(\|.+\|)\n([^\|\n])/g, '$1\n\n$2');   // blank line after last table row

            return s.trim() + '\n'; // tidy end
            }

        async function showResults() {
            // Calculate score
            let correctCount = 0;
            questions.forEach((q, i) => {
                if (userAnswers[i] === q.answer) {
                    correctCount++;
                }
            });

            const percentage = Math.round((correctCount / questions.length) * 100);

            // Switch to results page
            document.getElementById('quizPage').classList.remove('active');
            document.getElementById('resultsPage').classList.add('active');

            // Display score
            document.getElementById('scoreDisplay').textContent = percentage + '%';
            document.getElementById('scoreDetails').textContent = 
                `You answered ${correctCount} out of ${questions.length} correctly`;

            // Generate AI analysis with streaming
            try {
                const response = await fetch(`${API_BASE_URL}/api/quiz/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        topic: quizTopic,
                        questions: questions,
                        user_answers: userAnswers
                    })
                });

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let analysis = '';

                const analysisContainer = document.getElementById('analysisContent');
                analysisContainer.innerHTML = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;
                    
                    const chunk = decoder.decode(value);
                    analysis += chunk;
                    
                    // Parse markdown and render HTML
                    const htmlContent = marked.parse(beautifyAnalysis(analysis));
                    analysisContainer.innerHTML = htmlContent;
                    
                    // Auto-scroll to bottom
                    analysisContainer.scrollTop = analysisContainer.scrollHeight;
                }

            } catch (error) {
                console.error('Error:', error);
                document.getElementById('analysisContent').innerHTML = 
                    '<p style="color: #dc2626;">Failed to generate analysis. Please try again.</p>';
            }
        }

        function restartQuiz() {
            questions = [];
            currentQuestionIndex = 0;
            userAnswers = [];
            quizTopic = '';

            document.getElementById('resultsPage').classList.remove('active');
            document.getElementById('startPage').classList.remove('hidden');
            document.getElementById('topicInput').value = '';
            document.getElementById('numQuestions').value = '10';
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('generateBtn').innerHTML = 
                '<i class="fas fa-magic"></i> Generate Quiz';
        }

        // Allow Enter key to submit
        document.getElementById('topicInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                generateQuiz();
            }
        });
    </script>
</body>
</html>
